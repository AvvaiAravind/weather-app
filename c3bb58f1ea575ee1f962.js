import"../css/style.css";import{getElementFromDOM}from"./utilityFunctions";import{CurrentLocation}from"./currentLocation";import{setPlaceholderText,addSpinner,displayError,updateScreenReaderMsg,updateWeatherLocationHeader,displayApiErrror,updateDisplay,clearDisplay}from"./domFunctions";import{setLocationObj,getHomeLocation,cleanText,getCoordsFrmAPI,getWeatherFromCoords}from"./dataFunction";const currentLocObjFrmCls=new CurrentLocation;function initApp(){getElementFromDOM("id","getLocation").addEventListener("click",getGeoWeather),getElementFromDOM("id","home").addEventListener("click",loadWeather),getElementFromDOM("id","saveLocation").addEventListener("click",saveCurrentLocation),getElementFromDOM("id","unit").addEventListener("click",setUnitPreference),getElementFromDOM("id","refresh").addEventListener("click",refreshWeather),getElementFromDOM("id","searchBar__form").addEventListener("submit",submitNewLocation),setPlaceholderText(),loadWeather()}function getGeoWeather(e){if(e&&"click"===e.type){const e=getElementFromDOM("querySelector",".fa-map-marker-alt");addSpinner(e)}navigator.geolocation||geoError(),navigator.geolocation.getCurrentPosition(geoSuccess,geoError)}function geoError(e){const t=e?e.message:"Geolocation is not supported";displayError(t,t)}function geoSuccess(e){const t={lat:e.coords.latitude,lon:e.coords.longitude,name:`Lat: ${e.coords.latitude} and Lon: ${e.coords.longitude}`};setLocationObj(currentLocObjFrmCls,t),updateDataAndDisplay(currentLocObjFrmCls)}function loadWeather(e){const t=getHomeLocation();if(!t&&!e)return getGeoWeather();if(t||"click"!==e.type)if(t&&!e)displayHomeLocationWeather();else{const e=getElementFromDOM("querySelector",".fa-home");addSpinner(e),displayHomeLocationWeather(t)}else clearDisplay(),displayError("Home location is not saved. So please save the location first","Home location is not saved. So please save the location first")}function displayHomeLocationWeather(e){if("string"==typeof e){const t=JSON.parse(e),r={lat:t.lat,lon:t.lon,name:t.name,unit:t.unit};setLocationObj(currentLocObjFrmCls,r),updateDataAndDisplay(currentLocObjFrmCls)}}function saveCurrentLocation(){if(null!==currentLocObjFrmCls.lat&&null!==currentLocObjFrmCls.lon){const e=getElementFromDOM("querySelector",".fa-save");addSpinner(e);const t={lat:currentLocObjFrmCls.lat,lon:currentLocObjFrmCls.lon,name:currentLocObjFrmCls.name,unit:currentLocObjFrmCls.unit};localStorage.setItem("savedLocation",JSON.stringify(t)),updateWeatherLocationHeader("Current location is saved"),updateScreenReaderMsg("Current location is saved")}else clearDisplay(),displayError("Enable to get location coordinates please ensure location is turned on","Enable to get location coordinates please ensure location is turned on")}function setUnitPreference(){const e=getElementFromDOM("querySelector",".fa-chart-bar");addSpinner(e),currentLocObjFrmCls.toggleUnit(),updateDataAndDisplay(currentLocObjFrmCls)}function refreshWeather(){const e=getElementFromDOM("querySelector",".fa-sync-alt");addSpinner(e),updateDataAndDisplay(currentLocObjFrmCls)}async function submitNewLocation(e){e.preventDefault();let t=getElementFromDOM("id","searchBar__text").value;if(t=cleanText(t),!t.length)return;const r=getElementFromDOM("querySelector",".fa-search");addSpinner(r);const o=await getCoordsFrmAPI(t,currentLocObjFrmCls.unit);if(o)if(200===o.response.status){const e={lat:o.weatherData.latitude,lon:o.weatherData.longitude,name:o.weatherData.address?`${o.weatherData.address}`:`Lat: ${o.weatherData.latitude} Lon: ${o.weatherData.longitude}`};setLocationObj(currentLocObjFrmCls,e),updateDataAndDisplay(currentLocObjFrmCls)}else clearDisplay(),displayApiErrror(o.response.statusText);else clearDisplay(),displayError("Connnection Error","Connection Error")}async function updateDataAndDisplay(e){if(null!==e.lat&&null!==e.lon){const t=await getWeatherFromCoords(e);t?t.weatherData?updateDisplay(t.weatherData,e):(clearDisplay(),displayApiErrror(t.response.statusText)):(clearDisplay(),displayError("Connnection Error","Connection Error"))}else clearDisplay(),displayError("Enable to get location coordinates please ensure location is turned on","Enable to get location coordinates please ensure location is turned on")}document.addEventListener("DOMContentLoaded",initApp);